<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module contains the last use analysis pass which is run on each function before the ownership pass when the experimental ownership scheme is enabled. This pass does not run without this experimental flag - and if it did its results would go unused."><title>noirc_frontend::ownership::last_uses - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="noirc_frontend" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0 (4d91de4e4 2025-02-17)" data-channel="1.85.0" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../noirc_frontend/index.html">noirc_<wbr>frontend</a><span class="version">1.0.0-beta.18</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module last_<wbr>uses</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In noirc_<wbr>frontend::<wbr>ownership</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../index.html">noirc_frontend</a>::<wbr><a href="../index.html">ownership</a></span><h1>Module <span>last_uses</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/noirc_frontend/ownership/last_uses.rs.html#1-477">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module contains the last use analysis pass which is run on each function before
the ownership pass when the experimental ownership scheme is enabled. This pass does
not run without this experimental flag - and if it did its results would go unused.</p>
<p>The purpose of this pass is to find which instance of a variable is the variableâ€™s
last use. Note that a variable may have multiple last uses. This can happen if the
variableâ€™s last use is within an <code>if</code> expression or similar. It could be last used
in one place in the <code>then</code> branch and in another place in the <code>else</code> branch as long
as no code after the <code>if</code> expression uses the same variable.</p>
<p>This pass works by tracking the last use location for each variable with a
â€œloop indexâ€ and a <code>Branches</code> enumeration.</p>
<ul>
<li>The loop index tracks the loop level the variable was declared in. A variable
must be cloned in any loop with an index greater than the variableâ€™s own loop index.
Note that â€œloop indexâ€ refers to how nested we are within loops. A function starts
in index 0, and when we enter the body of a <code>loop {}</code> or <code>for _ in a..b {}</code>, the index
increments by 1. So <code>b</code> in <code>loop { for _ in 0..1 { b } }</code> would have index <code>2</code>.</li>
<li>The <code>Branches</code> enumeration holds each current last use of a variable.
<ul>
<li>In the common case this will be <code>Branches::Direct(ident_id)</code> indicating that <code>ident_id</code>
is the last use of its variable and it was not moved into an <code>if</code> or <code>match</code>.</li>
<li>When the variable is used within an <code>if</code> or <code>match</code> its last use will have a value of
<code>Branches::IfOrMatch(cases)</code> with the given nested last uses in each case of the if/match.</li>
</ul>
</li>
<li>This pass is not sophisticated with regard to struct and tuple fields. It currently
ignores these entirely and counts each use as a use of the entire variable. This is an
area for future optimization. E.g. the program <code>a.b.c; a.e.f</code> will result in <code>a</code> being
cloned in its entirety in the first statement. Note that this is lessened in the overall
ownership pass such that only <code>.c</code> is cloned but it is still an area for improvement.</li>
</ul>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BranchId.html" title="struct noirc_frontend::ownership::last_uses::BranchId">Branch<wbr>Id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">The Id for a single branch of an if or match</div></li><li><div class="item-name"><a class="struct" href="struct.IfOrMatchId.html" title="struct noirc_frontend::ownership::last_uses::IfOrMatchId">IfOr<wbr>Match<wbr>Id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">The Id of an <code>if</code> or <code>match</code>, used to distinguish multiple sequential ifs/matches
from each other.</div></li><li><div class="item-name"><a class="struct" href="struct.LastUseContext.html" title="struct noirc_frontend::ownership::last_uses::LastUseContext">Last<wbr>UseContext</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Branches.html" title="enum noirc_frontend::ownership::last_uses::Branches">Branches</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">A variableâ€™s last use may be split into several branches. E.g:</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.BranchesPath.html" title="type noirc_frontend::ownership::last_uses::BranchesPath">Branches<wbr>Path</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">A single path through a <code>Branches</code> enum.</div></li></ul></section></div></main></body></html>