<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The comptime interpreter is a tree-walking interpreter used for evaluating Noir code at compile-time. It is typically triggered (by the elaborator) in one of four scenarios:"><title>noirc_frontend::hir::comptime::interpreter - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="noirc_frontend" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0 (4d91de4e4 2025-02-17)" data-channel="1.85.0" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../noirc_frontend/index.html">noirc_<wbr>frontend</a><span class="version">1.0.0-beta.17</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module interpreter</a></h2><h3><a href="#modules">Module Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In noirc_<wbr>frontend::<wbr>hir::<wbr>comptime</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../../index.html">noirc_frontend</a>::<wbr><a href="../../index.html">hir</a>::<wbr><a href="../index.html">comptime</a></span><h1>Module <span>interpreter</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/noirc_frontend/hir/comptime/interpreter.rs.html#1-1963">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The comptime interpreter is a tree-walking interpreter used for evaluating Noir code
at compile-time. It is typically triggered (by the elaborator) in one of four scenarios:</p>
<ol>
<li>A <code>comptime {}</code> block</li>
</ol>
<ul>
<li>Everything in the block is interpreted</li>
</ul>
<ol start="2">
<li>A macro call <code>foo!()</code></li>
</ol>
<ul>
<li>The interpreter calls the function <code>foo</code> and inlines the resulting <code>Quoted</code> code at the callsite.</li>
</ul>
<ol start="3">
<li>An attribute call <code>#[my_attr] struct Foo {}</code></li>
</ol>
<ul>
<li>The interpreter calls the function <code>my_attr</code> and, if <code>my_attr</code> returns a <code>Quoted</code> value,
inlines the resulting <code>Quoted</code> code.</li>
</ul>
<ol start="4">
<li>A global <code>global FOO = expr;</code></li>
</ol>
<ul>
<li>The interpreter evaluates <code>expr</code> to simplify the global to a constant.</li>
<li>This means any side-effects in <code>expr</code> will be performed at compile-time (!).
<ul>
<li>This may change in the future.</li>
</ul>
</li>
</ul>
<p>The interpreter operates on the HIR which only requires interpreted code to be elaborated
before-hand, it does not need to be translated into another IR. Operating on high-level
code like this makes the interpreter more predictable, hopefully limiting bugs, but does
make it rather slow in practice.</p>
<p>Since unquoting macros may result in new variables in scope, the elaborator must run on that
code after the interpreter is run. Yet the requirement that the interpreter runs on HIR means
the interpreter must run in the middle of the elaborator. The usual flow is for the elaborator
to elaborate as it goes, creating new HIR. Then when it sees a <code>comptime {}</code> block or other
item that must be interpreted, it elaborates the entire item, creates and runs an <a href="../struct.Interpreter.html" title="struct noirc_frontend::hir::comptime::Interpreter">Interpreter</a>
on it, inlines the result, and continues elaborating the rest of the code.</p>
<p>Also note that although it runs on code that has already been elaborated, in general it is
still possible to invoke the interpreter on code which contains errors, such as type errors.
For this reason, the interpreter must still perform error-checking at least in cases where
we cannot continue otherwise. This can result in similar errors being issued for the same
code. For example, a functionâ€™s body may fail to type check, but that same function may
be called in the interpreter later on where weâ€™d presumably halt with a similar error.
<a href="../enum.InterpreterError.html#variant.ArgumentCountMismatch" title="variant noirc_frontend::hir::comptime::InterpreterError::ArgumentCountMismatch">InterpreterError::ArgumentCountMismatch</a> is an example of such an error.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="builtin/index.html" title="mod noirc_frontend::hir::comptime::interpreter::builtin">builtin</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Large file containing implementations of all the various built-in functions
which can be called in the interpreter. This notably includes the entire comptime-API
defined in <code>noir_stdlib/src/meta/*</code></div></li><li><div class="item-name"><a class="mod" href="cast/index.html" title="mod noirc_frontend::hir::comptime::interpreter::cast">cast</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="foreign/index.html" title="mod noirc_frontend::hir::comptime::interpreter::foreign">foreign</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The foreign function counterpart to <code>interpreter/builtin.rs</code>, defines how to call
all foreign functions available to the interpreter.</div></li><li><div class="item-name"><a class="mod" href="infix/index.html" title="mod noirc_frontend::hir::comptime::interpreter::infix">infix</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="unquote/index.html" title="mod noirc_frontend::hir::comptime::interpreter::unquote">unquote</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Interpreter.html" title="struct noirc_frontend::hir::comptime::interpreter::Interpreter">Interpreter</a></div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.MAX_EVALUATION_DEPTH.html" title="constant noirc_frontend::hir::comptime::interpreter::MAX_EVALUATION_DEPTH">MAX_<wbr>EVALUATION_<wbr>DEPTH</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Maximum depth of evaluation, limiting recursion during comptime as well as
expression depth. The goal is to be able to provide Noir stack traces if
we run out, rather than a Rust backtrace.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.bounds_check.html" title="fn noirc_frontend::hir::comptime::interpreter::bounds_check">bounds_<wbr>check</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Bounds check the given array and index pair.
This will also ensure the given arguments are in fact an array and integer.</div></li><li><div class="item-name"><a class="fn" href="fn.evaluate_integer.html" title="fn noirc_frontend::hir::comptime::interpreter::evaluate_integer">evaluate_<wbr>integer</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.evaluate_prefix_with_value.html" title="fn noirc_frontend::hir::comptime::interpreter::evaluate_prefix_with_value">evaluate_<wbr>prefix_<wbr>with_<wbr>value</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.force_bind_all.html" title="fn noirc_frontend::hir::comptime::interpreter::force_bind_all">force_<wbr>bind_<wbr>all</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.to_i128.html" title="fn noirc_frontend::hir::comptime::interpreter::to_i128">to_i128</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.to_u128.html" title="fn noirc_frontend::hir::comptime::interpreter::to_u128">to_u128</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.unbind_all.html" title="fn noirc_frontend::hir::comptime::interpreter::unbind_all">unbind_<wbr>all</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul></section></div></main></body></html>