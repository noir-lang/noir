<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Given an array access on a length 1 array such as:"><title>optimize_length_one_array_read in noirc_evaluator::ssa::ir::dfg::simplify - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../../../" data-static-root-path="../../../../../static.files/" data-current-crate="noirc_evaluator" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0 (4d91de4e4 2025-02-17)" data-channel="1.85.0" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../../../../static.files/storage-59e33391.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../../noirc_evaluator/index.html">noirc_<wbr>evaluator</a><span class="version">1.0.0-beta.18</span></h2></div><div class="sidebar-elems"><div id="rustdoc-modnav"><h2><a href="index.html">In noirc_<wbr>evaluator::<wbr>ssa::<wbr>ir::<wbr>dfg::<wbr>simplify</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../../../index.html">noirc_evaluator</a>::<wbr><a href="../../../index.html">ssa</a>::<wbr><a href="../../index.html">ir</a>::<wbr><a href="../index.html">dfg</a>::<wbr><a href="index.html">simplify</a></span><h1>Function <span class="fn">optimize_length_one_array_read</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../../src/noirc_evaluator/ssa/ir/dfg/simplify.rs.html#344-365">Source</a> </span></div><pre class="rust item-decl"><code>fn optimize_length_one_array_read(
    dfg: &amp;mut <a class="struct" href="../struct.DataFlowGraph.html" title="struct noirc_evaluator::ssa::ir::dfg::DataFlowGraph">DataFlowGraph</a>,
    block: <a class="type" href="../../basic_block/type.BasicBlockId.html" title="type noirc_evaluator::ssa::ir::basic_block::BasicBlockId">BasicBlockId</a>,
    call_stack: CallStackId,
    array: <a class="type" href="../../value/type.ValueId.html" title="type noirc_evaluator::ssa::ir::value::ValueId">ValueId</a>,
    index: <a class="type" href="../../value/type.ValueId.html" title="type noirc_evaluator::ssa::ir::value::ValueId">ValueId</a>,
) -&gt; <a class="enum" href="enum.SimplifyResult.html" title="enum noirc_evaluator::ssa::ir::dfg::simplify::SimplifyResult">SimplifyResult</a></code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Given an array access on a length 1 array such as:</p>
<div class="example-wrap"><pre class="language-ssa"><code>v2 = make_array [v0] : [Field; 1]
v3 = array_get v2, index v1 -&gt; Field</code></pre></div>
<p>We want to replace the array read with the only valid value which can be read from the array
while ensuring that if there is an attempt to read past the end of the array then the program fails.</p>
<p>We then inject an explicit assertion that the index variable has the value zero while replacing the value
being used in the <code>array_get</code> instruction with a constant value of zero. This then results in the SSA:</p>
<div class="example-wrap"><pre class="language-ssa"><code>v2 = make_array [v0] : [Field; 1]
constrain v1 == u32 0, &quot;Index out of bounds&quot;
v4 = array_get v2, index u32 0 -&gt; Field</code></pre></div>
<p>We then attempt to resolve the array read immediately.</p>
<p>Note that this does not work if the array has length 1, but contains a complex type such as tuple,
which consists of multiple elements. If that is the case than the <code>index</code> will most likely not be
a constant, but a base plus an offset, and if the array contains repeated elements of the same type
for example, we wouldnâ€™t be able to come up with a constant offset even if we knew the return type.</p>
</div></details></section></div></main></body></html>