<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="If we have an array set whose value is from an array get on the same array at the same index, we can simplify that array set to the array we were looking to perform an array set upon."><title>try_optimize_array_set_from_previous_get in noirc_evaluator::ssa::ir::dfg::simplify - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../../../" data-static-root-path="../../../../../static.files/" data-current-crate="noirc_evaluator" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0 (4d91de4e4 2025-02-17)" data-channel="1.85.0" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../../../../static.files/storage-59e33391.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../../noirc_evaluator/index.html">noirc_<wbr>evaluator</a><span class="version">1.0.0-beta.13</span></h2></div><div class="sidebar-elems"><div id="rustdoc-modnav"><h2><a href="index.html">In noirc_<wbr>evaluator::<wbr>ssa::<wbr>ir::<wbr>dfg::<wbr>simplify</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../../../index.html">noirc_evaluator</a>::<wbr><a href="../../../index.html">ssa</a>::<wbr><a href="../../index.html">ir</a>::<wbr><a href="../index.html">dfg</a>::<wbr><a href="index.html">simplify</a></span><h1>Function <span class="fn">try_optimize_array_set_from_previous_get</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../../src/noirc_evaluator/ssa/ir/dfg/simplify.rs.html#447-507">Source</a> </span></div><pre class="rust item-decl"><code>fn try_optimize_array_set_from_previous_get(
    dfg: &amp;<a class="struct" href="../struct.DataFlowGraph.html" title="struct noirc_evaluator::ssa::ir::dfg::DataFlowGraph">DataFlowGraph</a>,
    array_id: <a class="type" href="../../value/type.ValueId.html" title="type noirc_evaluator::ssa::ir::value::ValueId">ValueId</a>,
    target_index: <a class="type" href="../../value/type.ValueId.html" title="type noirc_evaluator::ssa::ir::value::ValueId">ValueId</a>,
    target_value: <a class="type" href="../../value/type.ValueId.html" title="type noirc_evaluator::ssa::ir::value::ValueId">ValueId</a>,
) -&gt; <a class="enum" href="enum.SimplifyResult.html" title="enum noirc_evaluator::ssa::ir::dfg::simplify::SimplifyResult">SimplifyResult</a></code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>If we have an array set whose value is from an array get on the same array at the same index,
we can simplify that array set to the array we were looking to perform an array set upon.</p>
<p>Simple case:
v3 = array_get v1, index v2
v5 = array_set v1, index v2, value v3</p>
<p>If we could not immediately simplify the array set from its value, we can try to follow
the array set backwards in the case we have constant indices:</p>
<p>v3 = array_get v1, index 1
v5 = array_set v1, index 2, value [Field 100, Field 101, Field 102]
v7 = array_set mut v5, index 1, value v3</p>
<p>We want to optimize <code>v7</code> to <code>v5</code>. We see that <code>v3</code> comes from an array get to <code>v1</code>. We follow <code>v5</code> backwards and see an array set
to <code>v1</code> and see that the previous array set occurs to a different constant index.</p>
<p>For each array_set:</p>
<ul>
<li>If the index is non-constant we fail the optimization since any index may be changed.</li>
<li>If the index is constant and is our target index, we conservatively fail the optimization.</li>
<li>Otherwise, we check the array value of the <code>array_set</code>. We will refer to this array as array’.
In the case above, array’ is <code>v1</code> from <code>v5 = array set ...</code>
<ul>
<li>If the original <code>array_set</code> value comes from an <code>array_get</code>, check the array in that <code>array_get</code> against array’.</li>
<li>If the two values are equal we can simplify.
<ul>
<li>Continuing the example above, as we have <code>v3 = array_get v1, index 1</code>, <code>v1</code> is
what we want to check against array’. We now know we can simplify <code>v7</code> to <code>v5</code> as it is unchanged.</li>
</ul>
</li>
<li>If they are not equal, recur marking the current <code>array_set</code> array as the new array id to use in the checks</li>
</ul>
</li>
</ul>
</div></details></section></div></main></body></html>