<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Dead Instruction Elimination (DIE) pass: Removes any instruction without side-effects for which the results are unused."><title>noirc_evaluator::ssa::opt::die - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="noirc_evaluator" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0 (4d91de4e4 2025-02-17)" data-channel="1.85.0" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../noirc_evaluator/index.html">noirc_<wbr>evaluator</a><span class="version">1.0.0-beta.18</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module die</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#design" title="Design">Design</a></li><li><a href="#runtime-differences" title="Runtime Differences">Runtime Differences</a></li><li><a href="#preconditions" title="Preconditions">Preconditions</a></li><li><a href="#post-conditions" title="Post-conditions">Post-conditions</a></li></ul><h3><a href="#modules">Module Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In noirc_<wbr>evaluator::<wbr>ssa::<wbr>opt</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../../index.html">noirc_evaluator</a>::<wbr><a href="../../index.html">ssa</a>::<wbr><a href="../index.html">opt</a></span><h1>Module <span>die</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/noirc_evaluator/ssa/opt/die.rs.html#1-1319">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Dead Instruction Elimination (DIE) pass: Removes any instruction without side-effects for
which the results are unused.</p>
<p>DIE also tracks which block parameters are unused.
Unused parameters are then pruned by the <a href="prune_dead_parameters/index.html" title="mod noirc_evaluator::ssa::opt::die::prune_dead_parameters">prune_dead_parameters</a> pass.</p>
<h3 id="design"><a class="doc-anchor" href="#design">Â§</a>Design</h3>
<ul>
<li>Instructions are scanned in reverse (within each block), keeping track of
used values. If the current instruction is safe for removal (no side effects)
and its results are all unused the instruction will be marked for removal.
Traversing in reverse enables removing entire unused chains of computation.</li>
<li>The pass also tracks unused <a href="../../ir/instruction/enum.Instruction.html#variant.IncrementRc" title="variant noirc_evaluator::ssa::ir::instruction::Instruction::IncrementRc">IncrementRc</a> and <a href="../../ir/instruction/enum.Instruction.html#variant.DecrementRc" title="variant noirc_evaluator::ssa::ir::instruction::Instruction::DecrementRc">DecrementRc</a> instructions.
As these instructions contain side effects we only remove them after analyzing an entire function to see if their values are unused.</li>
<li>Block parameters are also tracked. Unused parameters are pruned in a follow-up <a href="prune_dead_parameters/index.html" title="mod noirc_evaluator::ssa::opt::die::prune_dead_parameters">prune_dead_parameters</a> pass
to maintain separation of concerns and SSA consistency.</li>
<li>The main DIE pass and dead parameter pruning are called in a fixed point feedback loop that stops
once there are no more unused parameters.</li>
</ul>
<h3 id="runtime-differences"><a class="doc-anchor" href="#runtime-differences">Â§</a>Runtime Differences</h3>
<ul>
<li>ACIR
<ul>
<li>Array operations implicitly enforce OOB checks. DIE therefore
inserts synthetic OOB checks if array ops are removed, to preserve side-effect
ordering semantics.
As the SSA flattens all tuples, unused accesses on composite arrays can lead to potentially
multiple unused array accesses. As to avoid redundant OOB checks, we search for â€œarray get groupsâ€
and only insert a single OOB check for an array get group.</li>
<li><a href="../../ir/instruction/enum.Instruction.html#variant.Store" title="variant noirc_evaluator::ssa::ir::instruction::Instruction::Store">Store</a> instructions can only be removed if the <code>flattened</code> flag is set.</li>
<li>Instructions that create the value which is returned in the databus (if present) is not removed.</li>
</ul>
</li>
<li>Brillig
<ul>
<li>Array operations are explicit and thus it is expected separate OOB checks
have been laid down. Thus, no extra instructions are inserted for unused array accesses.</li>
<li><a href="../../ir/instruction/enum.Instruction.html#variant.Store" title="variant noirc_evaluator::ssa::ir::instruction::Instruction::Store">Store</a> instructions are never removed.</li>
<li>The databus is never used to return values, so instructions to create a Field array to return are never generated.</li>
</ul>
</li>
</ul>
<h3 id="preconditions"><a class="doc-anchor" href="#preconditions">Â§</a>Preconditions</h3>
<ul>
<li>ACIR: By default the pass must be run after <a href="../mem2reg/index.html" title="mod noirc_evaluator::ssa::opt::mem2reg">mem2reg</a> and <a href="../flatten_cfg/index.html" title="mod noirc_evaluator::ssa::opt::flatten_cfg">CFG flattening</a>.
If the pass is run before these passes, it must be explicitly stated.</li>
<li>Must be run on the full <a href="../../ssa_gen/struct.Ssa.html" title="struct noirc_evaluator::ssa::ssa_gen::Ssa">Ssa</a>, not individual <a href="../../ir/function/struct.Function.html" title="struct noirc_evaluator::ssa::ir::function::Function">Function</a>s, to avoid dangling
parameter references from dead parameter pruning.</li>
</ul>
<h3 id="post-conditions"><a class="doc-anchor" href="#post-conditions">Â§</a>Post-conditions</h3>
<ul>
<li>If DIE was run after mem2reg and flattening, no unreachable
<a href="../../ir/instruction/enum.Instruction.html#variant.Load" title="variant noirc_evaluator::ssa::ir::instruction::Instruction::Load">Load</a> or <a href="../../ir/instruction/enum.Instruction.html#variant.Store" title="variant noirc_evaluator::ssa::ir::instruction::Instruction::Store">Store</a> instructions should remain in ACIR code.</li>
<li>All unused SSA instructions (pure ops, unused RCs, dead params) are removed.</li>
</ul>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="array_oob_checks/index.html" title="mod noirc_evaluator::ssa::opt::die::array_oob_checks">array_<wbr>oob_<wbr>checks</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="prune_dead_parameters/index.html" title="mod noirc_evaluator::ssa::opt::die::prune_dead_parameters">prune_<wbr>dead_<wbr>parameters</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">This module implements the pruning of unused block parameters from functions.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Context.html" title="struct noirc_evaluator::ssa::opt::die::Context">Context</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Per function context for tracking unused values and which instructions to remove.</div></li><li><div class="item-name"><a class="struct" href="struct.DIEResult.html" title="struct noirc_evaluator::ssa::opt::die::DIEResult">DIEResult</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.can_be_eliminated_if_unused.html" title="fn noirc_evaluator::ssa::opt::die::can_be_eliminated_if_unused">can_<wbr>be_<wbr>eliminated_<wbr>if_<wbr>unused</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.die_post_check.html" title="fn noirc_evaluator::ssa::opt::die::die_post_check">die_<wbr>post_<wbr>check</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Check post-execution properties:</div></li><li><div class="item-name"><a class="fn" href="fn.die_pre_check.html" title="fn noirc_evaluator::ssa::opt::die::die_pre_check">die_<wbr>pre_<wbr>check</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Check pre-execution properties:</div></li><li><div class="item-name"><a class="fn" href="fn.should_remove_store.html" title="fn noirc_evaluator::ssa::opt::die::should_remove_store">should_<wbr>remove_<wbr>store</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Store instructions must be removed by DIE in acir code, any load
instructions should already be unused by that point.</div></li></ul></section></div></main></body></html>