<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This file contains the loop unrolling pass for the new SSA IR."><title>noirc_evaluator::ssa::opt::unrolling - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="noirc_evaluator" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0 (4d91de4e4 2025-02-17)" data-channel="1.85.0" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../noirc_evaluator/index.html">noirc_<wbr>evaluator</a><span class="version">1.0.0-beta.18</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module unrolling</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In noirc_<wbr>evaluator::<wbr>ssa::<wbr>opt</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../../index.html">noirc_evaluator</a>::<wbr><a href="../../index.html">ssa</a>::<wbr><a href="../index.html">opt</a></span><h1>Module <span>unrolling</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/noirc_evaluator/ssa/opt/unrolling.rs.html#1-1870">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This file contains the loop unrolling pass for the new SSA IR.</p>
<p>This pass is divided into a few steps:</p>
<ol>
<li>Find all loops in the program (<code>find_all_loops</code>)</li>
<li>For each loop:
<ol>
<li>If the loop is in our list of loops that previously failed to unroll, skip it.</li>
<li>If we have previously modified any of the blocks in the loop,
restart from step 1 to refresh the context.</li>
<li>If not, try to unroll the loop. If successful, remember the modified
blocks. If unsuccessful either error if the abort_on_error flag is set,
or otherwise remember that the loop failed to unroll and leave it unmodified.</li>
</ol>
</li>
</ol>
<p>Note that this pass also often creates superfluous jmp instructions in the
program that will need to be removed by a later simplify CFG pass.</p>
<p>ACIR/Brillig differences within this pass:</p>
<ul>
<li>Brillig functions may contain loops using <code>continue</code> or <code>break</code> which this pass does not
support the unrolling of (running the pass on such functions is not an error).</li>
<li>Brillig functions only have small loops unrolled, where a small loop is defined as a loop
which, when unrolled, is estimated to have the same or fewer total instructions as it
has when not unrolled.</li>
<li>Unrolling may be reverted for brillig functions if the increase in instruction count is
greater than <code>max_bytecode_increase_percent</code> (if set).</li>
<li>Differing post-conditions (see below).</li>
</ul>
<p>Relevance to other passes:</p>
<ul>
<li>Loop unrolling is a required pass for constrained code (ACIR functions) since ACIR itself
does not contain any branching constructs.</li>
<li>Loop unrolling must occur before flattening on ACIR functions</li>
<li>Since unrolling may fail on loops that fail to unroll, any simplification passes before it
which affect loop bounds may affect which code fails to compile. One important optimization
in this category is mem2reg which may simplify mutable variables, including those potentially
used as loop bounds, into a form which loop unrolling may better identify.</li>
</ul>
<p>Conditions:</p>
<ul>
<li>Pre-condition: All loop headers have a single induction variable.</li>
<li>Pre-condition: The SSA must be optimized to a point at which loop bounds are known.
Some passes such as inlining and mem2reg are de-facto required before running this pass on arbitrary noir code.</li>
<li>Post-condition (ACIR-only): All loops in ACIR functions should be unrolled when this pass is
completed successfully. Any loops that are not unrolled (e.g. because of a mutable variable
used in the loop condition whose value is unknown) will result in an error.</li>
<li>Post-condition (Brillig-only): If <code>max_bytecode_increase_percent</code> is set, the instruction count
of each function should increase by no more than that percentage compared to before the pass.</li>
</ul>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BoilerplateStats.html" title="struct noirc_evaluator::ssa::opt::unrolling::BoilerplateStats">Boilerplate<wbr>Stats</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">All the instructions in the following example are boilerplate:</div></li><li><div class="item-name"><a class="struct" href="struct.Loop.html" title="struct noirc_evaluator::ssa::opt::unrolling::Loop">Loop</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Describe the blocks that constitute up a loop.</div></li><li><div class="item-name"><a class="struct" href="struct.LoopIteration.html" title="struct noirc_evaluator::ssa::opt::unrolling::LoopIteration">Loop<wbr>Iteration</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The context object for each loop iteration.
Notably each loop iteration maps each loop block to a fresh, unrolled block.</div></li><li><div class="item-name"><a class="struct" href="struct.Loops.html" title="struct noirc_evaluator::ssa::opt::unrolling::Loops">Loops</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">All the unrolled loops in the SSA.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.get_induction_variable.html" title="fn noirc_evaluator::ssa::opt::unrolling::get_induction_variable">get_<wbr>induction_<wbr>variable</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Return the induction value of the current iteration of the loop, from the given blockâ€™s jmp arguments.</div></li><li><div class="item-name"><a class="fn" href="fn.is_new_size_ok.html" title="fn noirc_evaluator::ssa::opt::unrolling::is_new_size_ok">is_<wbr>new_<wbr>size_<wbr>ok</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Decide if the new bytecode size is acceptable, compared to the original.</div></li><li><div class="item-name"><a class="fn" href="fn.simplify_between_unrolls.html" title="fn noirc_evaluator::ssa::opt::unrolling::simplify_between_unrolls">simplify_<wbr>between_<wbr>unrolls</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Unrolling leaves some duplicate instructions which can potentially be removed.</div></li></ul></section></div></main></body></html>