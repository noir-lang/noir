<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module defines the defunctionalization pass for the SSA IR. Certain IR targets (e.g., Brillig and ACIR) do not support higher-order functions directly."><title>noirc_evaluator::ssa::opt::defunctionalize - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="noirc_evaluator" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0 (4d91de4e4 2025-02-17)" data-channel="1.85.0" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../noirc_evaluator/index.html">noirc_<wbr>evaluator</a><span class="version">1.0.0-beta.18</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module defunctionalize</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#how-the-pass-works" title="How the pass works:">How the pass works:</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In noirc_<wbr>evaluator::<wbr>ssa::<wbr>opt</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../../index.html">noirc_evaluator</a>::<wbr><a href="../../index.html">ssa</a>::<wbr><a href="../index.html">opt</a></span><h1>Module <span>defunctionalize</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/noirc_evaluator/ssa/opt/defunctionalize.rs.html#1-2286">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module defines the defunctionalization pass for the SSA IR.
Certain IR targets (e.g., Brillig and ACIR) do not support higher-order functions directly.</p>
<p>The pass eliminates higher-order functions (a function which accepts function values as arguments or returns functions)
by transforming functions used as values (i.e., first-class functions)
into constant numbers (fields) that represent their function IDs.</p>
<p>Defunctionalization handles higher-order functions by lowering function values into
constant identifiers and replacing calls of function values with calls to a single
dispatch <code>apply</code> function.</p>
<h3 id="how-the-pass-works"><a class="doc-anchor" href="#how-the-pass-works">Â§</a>How the pass works:</h3>
<ul>
<li>Every function used as a value (e.g., passed as a parameter) is assigned a unique <a href="../../ir/types/enum.NumericType.html#variant.NativeField" title="variant noirc_evaluator::ssa::ir::types::NumericType::NativeField">NumericType::NativeField</a> value.
This value now represents the first-class functionâ€™s ID.</li>
<li>All call instructions with non-literal targets are replaced by calls to an <code>apply</code> function.</li>
<li>The <code>apply</code> function is a dispatcher. It takes the function ID as its first argument
and calls the appropriate function based on that ID.</li>
</ul>
<p>Pseudocode of an <code>apply</code> function is given below:</p>
<div class="example-wrap"><pre class="language-text"><code>fn apply(function_id: Field, arg1: Field, arg2: Field) -&gt; Field {
    match function_id {
        0 -&gt; function0(arg1, arg2),
        1 -&gt; function1(arg1, arg2),
        ...
        N -&gt; functionN(arg1, arg2),
    }
}</code></pre></div>
<p>After this pass all first-class functions are replaced with numeric IDs
and calls are routed via the newly generated <code>apply</code> functions.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ApplyFunction.html" title="struct noirc_evaluator::ssa::opt::defunctionalize::ApplyFunction">Apply<wbr>Function</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Represents an â€˜applyâ€™ function created by this pass to dispatch higher order functions to.
Pseudocode of an <code>apply</code> function is given below:</div></li><li><div class="item-name"><a class="struct" href="struct.DefunctionalizationContext.html" title="struct noirc_evaluator::ssa::opt::defunctionalize::DefunctionalizationContext">Defunctionalization<wbr>Context</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Performs defunctionalization on all functions
This is done by changing all functions as value to be a number (FieldElement)
And creating apply functions that dispatch to the correct target by runtime comparisons with constants</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.create_apply_function.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::create_apply_function">create_<wbr>apply_<wbr>function</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Creates a single apply function to enable dispatch across multiple function variants
that share the same <a href="../../ir/function/struct.Signature.html" title="struct noirc_evaluator::ssa::ir::function::Signature">Signature</a> and <a href="../../ir/function/enum.RuntimeType.html" title="enum noirc_evaluator::ssa::ir::function::RuntimeType">RuntimeType</a>.</div></li><li><div class="item-name"><a class="fn" href="fn.create_apply_functions.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::create_apply_functions">create_<wbr>apply_<wbr>functions</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Creates all apply functions needed for dispatch of function values.</div></li><li><div class="item-name"><a class="fn" href="fn.create_dummy_function.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::create_dummy_function">create_<wbr>dummy_<wbr>function</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Creates a placeholder (dummy) function to replace calls to invalid function references.
An example of a possible invalid function reference is an out-of-bounds access on a zero-length function array.</div></li><li><div class="item-name"><a class="fn" href="fn.defunctionalize_post_check.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::defunctionalize_post_check">defunctionalize_<wbr>post_<wbr>check</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Check post-execution properties:</div></li><li><div class="item-name"><a class="fn" href="fn.defunctionalize_pre_check.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::defunctionalize_pre_check">defunctionalize_<wbr>pre_<wbr>check</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Check pre-execution properties.</div></li><li><div class="item-name"><a class="fn" href="fn.find_dynamic_dispatches.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::find_dynamic_dispatches">find_<wbr>dynamic_<wbr>dispatches</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Finds all dynamic dispatch signatures in the given function.
Note that these are the signatures before function types are mutated to turn into field types.</div></li><li><div class="item-name"><a class="fn" href="fn.find_functions_as_values.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::find_functions_as_values">find_<wbr>functions_<wbr>as_<wbr>values</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Finds all literal functions used as values in the given function</div></li><li><div class="item-name"><a class="fn" href="fn.find_variants.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::find_variants">find_<wbr>variants</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Collects all functions used as values that can be called by their signatures</div></li><li><div class="item-name"><a class="fn" href="fn.function_id_to_field.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::function_id_to_field">function_<wbr>id_<wbr>to_<wbr>field</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Transforms a <a href="../../ir/function/type.FunctionId.html" title="type noirc_evaluator::ssa::ir::function::FunctionId">FunctionId</a> into a <a href="../../../../acir_field/type.FieldElement.html" title="type acir_field::FieldElement">FieldElement</a></div></li><li><div class="item-name"><a class="fn" href="fn.make_dummy_return_data.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::make_dummy_return_data">make_<wbr>dummy_<wbr>return_<wbr>data</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Construct a dummy value to be returned from the placeholder function for calls to invalid lambda references.
We need to construct the appropriate value so that our SSA is well formed even if the function
pointer has no variants.</div></li><li><div class="item-name"><a class="fn" href="fn.map_function_to_field.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::map_function_to_field">map_<wbr>function_<wbr>to_<wbr>field</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Try to map the given function literal to a field, returning Some(field) on success.
Returns none if the given value was not a function or doesnâ€™t need to be mapped.</div></li><li><div class="item-name"><a class="fn" href="fn.remove_first_class_functions_in_instruction.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::remove_first_class_functions_in_instruction">remove_<wbr>first_<wbr>class_<wbr>functions_<wbr>in_<wbr>instruction</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Replace any first class functions used in an instruction with a field value.
This applies to any function used anywhere else other than the function position
of a call instruction. Returns true if the instruction was modified</div></li><li><div class="item-name"><a class="fn" href="fn.replacement_type.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::replacement_type">replacement_<wbr>type</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Return what type a function value type should be replaced with:</div></li><li><div class="item-name"><a class="fn" href="fn.replacement_types.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::replacement_types">replacement_<wbr>types</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Take a list of types that might need replacement.
Replaces the ones that need replacement, leaving all others as-is.
If no type needs replacement, <code>None</code> is returned.</div></li><li><div class="item-name"><a class="fn" href="fn.visit_values_other_than_call_target.html" title="fn noirc_evaluator::ssa::opt::defunctionalize::visit_values_other_than_call_target">visit_<wbr>values_<wbr>other_<wbr>than_<wbr>call_<wbr>target</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Visit all values which are <em>not</em> targets of a <code>Call</code>.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.ApplyFunctions.html" title="type noirc_evaluator::ssa::opt::defunctionalize::ApplyFunctions">Apply<wbr>Functions</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">All generated apply functions for each grouping of function variants.
Each apply function is handles a specific (<a href="../../ir/function/struct.Signature.html" title="struct noirc_evaluator::ssa::ir::function::Signature">Signature</a>, <a href="../../ir/function/enum.RuntimeType.html" title="enum noirc_evaluator::ssa::ir::function::RuntimeType">RuntimeType</a>) group.
Maps (<a href="../../ir/function/struct.Signature.html" title="struct noirc_evaluator::ssa::ir::function::Signature">Signature</a>, <a href="../../ir/function/enum.RuntimeType.html" title="enum noirc_evaluator::ssa::ir::function::RuntimeType">RuntimeType</a>) -&gt; <a href="struct.ApplyFunction.html" title="struct noirc_evaluator::ssa::opt::defunctionalize::ApplyFunction">ApplyFunction</a></div></li><li><div class="item-name"><a class="type" href="type.Variants.html" title="type noirc_evaluator::ssa::opt::defunctionalize::Variants">Variants</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">All functions used as a value that share the same signature and runtime type
Maps (<a href="../../ir/function/struct.Signature.html" title="struct noirc_evaluator::ssa::ir::function::Signature">Signature</a>, Caller <a href="../../ir/function/enum.RuntimeType.html" title="enum noirc_evaluator::ssa::ir::function::RuntimeType">RuntimeType</a>) -&gt; Vec&lt;(<a href="../../ir/function/type.FunctionId.html" title="type noirc_evaluator::ssa::ir::function::FunctionId">FunctionId</a>, Callee <a href="../../ir/function/enum.RuntimeType.html" title="enum noirc_evaluator::ssa::ir::function::RuntimeType">RuntimeType</a>)&gt;</div></li></ul></section></div></main></body></html>