name: Track ACVM for Integration Tests

on:
  push:
    branches:
      - master
      - jb-track-acvm-integration-tests

jobs:
  check_version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Check acvm version change
        run: |
          # Extract acvm version from the current Cargo.lock
          CURRENT_VERSION=$(awk '/name = "acvm"/ {getline; print $3}' Cargo.lock | tr -d '"')

          # Extract acvm version from the previous commit's Cargo.lock
          PREVIOUS_VERSION=$(git show HEAD~1:Cargo.lock | awk '/name = "acvm"/ {getline; print $3}' Cargo.lock | tr -d '"')

          echo "Current Version: $CURRENT_VERSION"
          echo "Previous Version: $PREVIOUS_VERSION"

          if [ "$CURRENT_VERSION" != "$PREVIOUS_VERSION" ]; then
            echo "acvm version changed!"
            exit 1
          else
            echo "acvm version remains the same."
          fi
